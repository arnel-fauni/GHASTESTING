name: GHAS Slack Notifications
on: [push, pull_request]
jobs:
  ghas-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      # CodeQL Analysis (Code Scanning)
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: javascript,python  # Add your repo languages
      
      - name: Perform CodeQL Analysis  
        uses: github/codeql-action/analyze@v3
      
      # Secret Scanning
      - name: Run Secret Scanning
        uses: github/secret-scanning-action@v1

  notify:
    needs: ghas-scan
    runs-on: ubuntu-latest
    steps:
      - name: Slack Notification
        if: always()
        uses: slackapi/slack-github-action@v1.26.0
        with:
          payload: |
            {
              "text": "ğŸ” *${{ github.workflow }}* completed!\nğŸ“Š *Status:* ${{ needs.ghas-scan.result }}\nğŸ“‚ Repo: ${{ github.repository }}\nğŸ”¢ Run: #${{ github.run_number }}\nğŸ›¡ï¸ *CodeQL:* ${{ needs.ghas-scan.result }}\nğŸ”‘ *Secret Scanning:* ${{ needs.ghas-scan.result }}\nğŸ“‹ <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Run>"
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
